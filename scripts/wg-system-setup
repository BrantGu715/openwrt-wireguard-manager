#!/bin/sh
set -e

echo "WireGuard 系统初始化"
echo "================================================="

# 1. 确保目录
mkdir -p /etc/wireguard/clients

# 2. clients.map
[ -f /etc/wireguard/clients/clients.map ] || \
    touch /etc/wireguard/clients/clients.map

# 3. IP Forward
sysctl -w net.ipv4.ip_forward=1 >/dev/null
uci set system.@system[0].ip_forward='1'
uci commit system

echo "IP Forward 已开启"

# 4. 权限
chmod 600 /etc/wireguard/*.key 2>/dev/null || true

echo "================================================="
echo "✅ 初始化完成"
echo "下一步建议:"
echo "  wg-port-check"
echo "  wg-client-add phone"
